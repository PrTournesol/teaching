<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="J.-M. Bruel">
<title>Gestion de version avec git</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./pygments-default.css">
</head>
<body id="git" class="article toc2 toc-left">
<div id="header">
<h1>Gestion de version avec <strong>git</strong></h1>
<div class="details">
<span id="author" class="author">J.-M. Bruel</span><br>
<span id="email" class="email"><a href="mailto:jbruel@gmail.com">jbruel@gmail.com</a></span><br>
<span id="revnumber">version 2.0 2016-09-28</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table des matières</div>
<ul class="sectlevel1">
<li><a href="#_environnement">1. Environnement</a></li>
<li><a href="#_principes_généraux">2. Principes généraux</a></li>
<li><a href="#_avant_de_commencer">3. Avant de commencer</a></li>
<li><a href="#_scénario_strong_classique_strong_et_idéal">4. Scénario <strong>classique</strong> (et idéal)</a>
<ul class="sectlevel2">
<li><a href="#_etape_1_création_du_em_repository_em_local">4.1. Etape 1 : création du <em>repository</em> local</a></li>
<li><a href="#_etape_2_ajout_des_fichiers">4.2. Etape 2 : ajout des fichiers</a></li>
<li><a href="#_etape_2_suite_vérification">4.3. Etape 2 (suite) : vérification</a></li>
<li><a href="#_etape_3_commit">4.4. Etape 3 : Commit</a></li>
<li><a href="#_etape_3_suite_gestion_locale">4.5. Etape 3 (suite) : Gestion "locale"</a></li>
<li><a href="#_etape_4_trouver_un_hébergement_distant">4.6. Etape 4 : Trouver un hébergement distant</a></li>
<li><a href="#_etape_4_suite_déclarer_le_dépôt_distant">4.7. Etape 4 (suite) : déclarer le dépôt distant</a></li>
<li><a href="#_etape_5_branch_edit_commit_merge">4.8. Etape 5 : branch, edit, commit, merge</a></li>
<li><a href="#_etape_5_suite_branching">4.9. Etape 5 (suite) : branching</a></li>
<li><a href="#_etape_5_suite_edit">4.10. Etape 5 (suite) : edit</a></li>
<li><a href="#_etape_5_suite_commit">4.11. Etape 5 (suite) : commit</a></li>
<li><a href="#_etape_5_suite_utilisation_des_branches">4.12. Etape 5 (suite) : utilisation des branches</a></li>
<li><a href="#_etape_5_suite_merge">4.13. Etape 5 (suite) : merge</a></li>
<li><a href="#_etape_6_push">4.14. Etape 6 : push</a></li>
<li><a href="#pull-request">4.15. Etape 7 : pull request (demande)</a></li>
<li><a href="#_etape_7_suite_pull_request_acceptation">4.16. Etape 7 (suite) : pull request (acceptation)</a></li>
</ul>
</li>
<li><a href="#_dépôts_existants">5. Dépôts existants</a></li>
<li><a href="#_illustration_des_branches">6. Illustration des branches</a></li>
<li><a href="#_bonne_utilisation">7. Bonne utilisation</a>
<ul class="sectlevel2">
<li><a href="#_avoir_une_procédure_concertée">7.1. Avoir une procédure concertée</a></li>
<li><a href="#_ne_pas_versionner_n_importe_quoi">7.2. Ne pas versionner n&#8217;importe quoi!</a></li>
<li><a href="#_les_releases">7.3. Les "releases"</a></li>
</ul>
</li>
<li><a href="#_la_gestion_de_version_n_est_pas_un_long_fleuve_tranquille">8. La gestion de version n&#8217;est pas un long fleuve tranquille</a>
<ul class="sectlevel2">
<li><a href="#_oups_j_ai_oublié_un_truc">8.1. Oups! j&#8217;ai oublié un truc</a></li>
<li><a href="#_oups_j_ai_mis_trop_de_truc">8.2. Oups! j&#8217;ai mis trop de truc</a></li>
<li><a href="#_ctrl_z">8.3. CTRL+Z</a></li>
<li><a href="#_où_j_en_suis">8.4. Où j&#8217;en suis</a></li>
</ul>
</li>
<li><a href="#_gestion_des_branches">9. Gestion des branches</a></li>
<li><a href="#_les_différents_strong_merge_strong">10. Les différents <strong>merge</strong></a>
<ul class="sectlevel2">
<li><a href="#_explicit_code_merge_code">10.1. Explicit <code>merge</code></a></li>
<li><a href="#_implicit_code_merge_code_via_code_rebase_code_or_code_fast_forward_code">10.2. Implicit <code>merge</code> via <code>rebase</code> or <code>fast-forward</code></a></li>
<li><a href="#_implicit_code_merge_code_via_code_fast_forward_code">10.3. Implicit <code>merge</code> via <code>fast-forward</code></a></li>
<li><a href="#_squash_on_code_merge_code">10.4. Squash on <code>merge</code></a></li>
</ul>
</li>
<li><a href="#conflits">11. Gestion des conflits</a>
<ul class="sectlevel2">
<li><a href="#_À_la_main">11.1. À la main</a></li>
<li><a href="#_avec_un_peu_d_aide">11.2. Avec un peu d&#8217;aide</a></li>
</ul>
</li>
<li><a href="#_git_avancé_git_flow">12. Git avancé : Git-Flow</a></li>
<li><a href="#_résumé_des_commandes">13. Résumé des commandes</a></li>
<li><a href="#_liens_utiles">14. Liens utiles</a></li>
<li><a href="#_glossaire">15. Glossaire</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_environnement">1. Environnement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vous pouvez installer <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> depuis le site officiel.
Nous utilisons ici la version <code>2.9.2</code> en ligne de commande.
Mais vous pouvez bien sûr utiliser un client graphique (comme <a href="https://www.sourcetreeapp.com/" class="bare">https://www.sourcetreeapp.com/</a>).</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://www.sourcetreeapp.com"><img src="images/sourcetree.png" alt="sourcetree" width="50%"></a>
</div>
<div class="title">Figure 1. Client graphique (https://www.sourcetreeapp.com)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/git-term.png" alt="git term" width="49%">
</div>
<div class="title">Figure 2. Lignes de commande</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Je vous recommande tout de même de connaître les commandes en ligne, c&#8217;est souvent utile!
Pour vous familiariser avec les commandes <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> en ligne, ne pas hésiter à utiliser le site <a href="http://try.github.com/levels/1/challenges/1">http://try.github.com</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_principes_généraux">2. Principes généraux</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="http://nvie.com/posts/a-successful-git-branching-model/"><img src="images/git-branching.png" alt="git branching" width="70%"></a>
</div>
<div class="title">Figure 3. Usage classique de git (http://nvie.com/posts/a-successful-git-branching-model/)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ce modèle est controversé et ne fait pas l&#8217;unanimité.
Nous verrons dans la suite qu&#8217;il y a plus simple.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_avant_de_commencer">3. Avant de commencer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On initialise certaine variables (une fois pour toute en général) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git config --global user.name "JM Bruel"
$ git config --global user.email jbruel@gmail.com
$ git config --global alias.co checkout</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ces informations sont stockées dans le fichier <code>~/.gitcongif</code>.</p>
</div>
<div class="paragraph">
<p>Voici un extrait <a href="util/.gitconfig">du mien</a> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>[user]
        name = Jean-Michel Bruel
        email = jbruel@gmail.com
[alias]
        co = checkout
        st = status</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce qui donne :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git co
Your branch is ahead of 'origin/master' by 1 commit.
  (use "git push" to publish your local commits)
$ git checkout
Your branch is ahead of 'origin/master' by 1 commit.
  (use "git push" to publish your local commits)</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scénario_strong_classique_strong_et_idéal">4. Scénario <strong>classique</strong> (et idéal)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_etape_1_création_du_em_repository_em_local">4.1. Etape 1 : création du <em>repository</em> local</h3>
<div class="paragraph">
<p>On démarre la gestion de version :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git init</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Génération d&#8217;un répertoire <code>.git</code> dans le répertoire courant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git init
Initialized empty Git repository in /tmp/.git/

$ ll
total 0
drwxr-xr-x   3 bruel  admin   102 21 jul 17:29 ./
drwxr-xr-x  35 bruel  admin  1190 21 jul 17:29 ../
drwxr-xr-x  10 bruel  admin   340 21 jul 17:29 .git/</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_2_ajout_des_fichiers">4.2. Etape 2 : ajout des fichiers</h3>
<div class="paragraph">
<p>On ajoute les fichiers courants au dépôt :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git add .</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Ne pas forcément tout ajouter (<code>git add *.c</code> par exemple pour ne versionner que les sources).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Pensez à créer un fichier <code>.gitignore</code> pour éviter d&#8217;ajouter les fichiers indésirables (comme les fichiers de <code>log</code>).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_2_suite_vérification">4.3. Etape 2 (suite) : vérification</h3>
<div class="paragraph">
<p>On peut visualiser les actions en vérifiant l'<strong>état courant</strong> du dépôt :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git status
# On branch master
# Your branch is ahead of 'origin/master' by 1 commit.
#
# Changes not staged for commit:
#   (use "git add/rm &lt;file&gt;..." to update what will be committed)
#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
#
#	modified:   Generalites.txt
#	deleted:    S3/128056_56.d
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etape_3_commit">4.4. Etape 3 : Commit</h3>
<div class="paragraph">
<p>Pour entériner les changements :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git commit -m "First draft"
[master (root-commit) 4f40f5d] First draft
 0 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 titi.txt
 create mode 100644 toto.txt</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Retenez que le <code>commit</code> est uniquement local!</p>
</li>
<li>
<p>Mais même en local, il est bien utile en cas de problème.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_3_suite_gestion_locale">4.5. Etape 3 (suite) : Gestion "locale"</h3>
<div class="paragraph">
<p>Exemple de scénario type (suppression exceptionnelle et rattrapage) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ rm titi.txt
$ git status
# On branch master
# Changes not staged for commit:
#   (use "git add/rm &lt;file&gt;..." to update what will be committed)
#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
#
#	deleted:    titi.txt
#
no changes added to commit (use "git add" and/or "git commit -a")

$ git checkout -f
$ ls titi.txt
titi.txt</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etape_4_trouver_un_hébergement_distant">4.6. Etape 4 : Trouver un hébergement distant</h3>
<div class="paragraph">
<p>Il existe de nombreux endroits disponibles pour héberger du code libre.
Les plus connus sont <a href="https://github.com/">GitHub</a> et <span class="icon"><i class="fa fa-gitlab"></i></span><a href="https://gitlab.com/">GitLab</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/github.png" alt="github" width="70%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etape_4_suite_déclarer_le_dépôt_distant">4.7. Etape 4 (suite) : déclarer le dépôt distant</h3>
<div class="paragraph">
<p>Après avoir créé un dépôt distant, il n&#8217;y a plus qu&#8217;à associer ce
dépôt distant avec le notre.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git remote add origin git@github.com:jmbruel/first_app.git <i class="conum" data-value="1"></i><b>(1)</b>
$ git push -u origin master <i class="conum" data-value="2"></i><b>(2)</b>
Counting objects: 3, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (2/2), done.
Writing objects: 100% (3/3), 225 bytes, done.
Total 3 (delta 0), reused 0 (delta 0)
To git@github.com:jmbruel/first_app.git
 * [new branch]      master -&gt; master
Branch master set up to track remote branch master from origin.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Il est possible d&#8217;avoir plusieurs dépôts distants, celui-ci sera référencé par <code>origin</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>L&#8217;option <code>-u origin master</code> permet d&#8217;associer une fois pour toute les <code>git push</code> suivants au fait
de "pousser" sur la branche <code>master</code> du dépôt <code>origin</code> (comme l&#8217;indique la dernière ligne).</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_5_branch_edit_commit_merge">4.8. Etape 5 : branch, edit, commit, merge</h3>
<div class="paragraph">
<p>En cas d&#8217;édition et de commit local :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout
Your branch is ahead of 'origin/master' by 1 commit.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etape_5_suite_branching">4.9. Etape 5 (suite) : branching</h3>
<div class="paragraph">
<p><a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> est très bon pour créer des branches :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout -b testModifTiti
Switched to a new branch 'testModifTiti'
$ git branch
  master
* testModifTiti <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>La branche courante est repérée par un <code>*</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_5_suite_edit">4.10. Etape 5 (suite) : edit</h3>
<div class="paragraph">
<p>Après modification :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git status
# On branch testModifTiti
# Changes not staged for commit:
#   (use "git add &lt;file&gt;..." to update what will be committed)
#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
#
#	modified:   titi.txt
#
no changes added to commit (use "git add" and/or "git commit -a")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etape_5_suite_commit">4.11. Etape 5 (suite) : commit</h3>
<div class="paragraph">
<p>On "sauvegarde" les changements :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git commit -am "modif de titi"
[testModifTiti 4515b5d] modif de titi
 1 files changed, 7 insertions(+), 0 deletions(-)</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>On ne "sauvegarde" qu&#8217;en local!</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_5_suite_utilisation_des_branches">4.12. Etape 5 (suite) : utilisation des branches</h3>
<div class="paragraph">
<p>On peut "zapper" d&#8217;une branche à l&#8217;autre à volonté :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ ll titi*
-rw-rw-r--    1 bruel  staff   331 12 nov 12:39 titi.txt

$ git co master
Switched to branch 'master'
Your branch is ahead of 'origin/master' by 1 commit.

$ ll titi*
-rw-rw-r--    1 bruel  staff     0 12 nov 12:40 titi.txt</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_etape_5_suite_merge">4.13. Etape 5 (suite) : merge</h3>
<div class="paragraph">
<p>Maintenant que la branche a été développée (testée, etc.) on peut
l&#8217;intégrer à la branche principale :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git co master
Switched to branch 'master'

$ git merge testModifTiti
Merge made by recursive.
 titi.txt |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>On peut ensuite détruire la branche devenue inutile <code>git branch -d testModifTiti</code>.</p>
</li>
<li>
<p>C&#8217;est une bonne habitude à prendre.</p>
</li>
<li>
<p>Notez que l&#8217;historique des modifications (ainsi que les messages de commits successifs ne sont pas perdus).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_etape_6_push">4.14. Etape 6 : push</h3>
<div class="paragraph">
<p>Maintenant que notre dépôt est satisfaisant, on peut le synchroniser avec le dépôt distant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git push
Counting objects: 11, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (9/9), done.
Writing objects: 100% (9/9), 977 bytes, done.
Total 9 (delta 2), reused 0 (delta 0)
To git@github.com:jmbruel/first_app.git
   6103463..3aae48a  master -&gt; master</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pull-request">4.15. Etape 7 : pull request (demande)</h3>

</div>
<div class="sect2">
<h3 id="_etape_7_suite_pull_request_acceptation">4.16. Etape 7 (suite) : pull request (acceptation)</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout -b develop origin/develop
$ ...                       <i class="conum" data-value="1"></i><b>(1)</b>
$ git checkout master
$ git merge --no-ff develop <i class="conum" data-value="2"></i><b>(2)</b>
$ git push origin master    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Vérifiez ce qui va être intégré</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>On merge localement pour gérer les problèmes</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>On pousse sur master</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dépôts_existants">5. Dépôts existants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Si vous devez partir d&#8217;un dépôt existant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git clone git@github.com:jmbruel/first_app.git</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Pour obtenir le nom du dépôt distant : <code>git remote -v</code>.</p>
</li>
<li>
<p>Vous avez aussi le nom du dépôt distant dans le fichier <code>.git/config</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_illustration_des_branches">6. Illustration des branches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici une illustration de l&#8217;utilisation des branches (tirée de <a href="http://git-scm.com/book">git-scm</a>).</p>
</div>
<div class="paragraph">
<p>On part d&#8217;une situation type :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf1.svg" alt="gf1" width="50%">
</div>
<div class="title">Figure 4. Situation initiale</div>
</div>
<div class="paragraph">
<p>On crée une branche (appelée <code>iss53</code> ici pour indiquer qu&#8217;elle traite de l'<em>issue</em> numéro 53) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout -b iss53</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf2.svg" alt="gf2" width="40%">
</div>
<div class="title">Figure 5. Création d&#8217;une branche</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> n&#8217;a créé qu&#8217;un pointeur &#8658; aucun espace mémoire perdu.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On modifie et on commit :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ edit ...
$ git commit -m " blabla iss53"</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf3.svg" alt="gf3" width="50%">
</div>
<div class="title">Figure 6. On commence à diverger de <code>master</code></div>
</div>
<div class="paragraph">
<p>On revient à la branche maître pour tester une autre solution :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout master
$ git checkout -b hotfix
$ edit ...
$ git commit -m " blabla hotfix"</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf4.svg" alt="gf4" width="50%">
</div>
<div class="title">Figure 7. Maintenant on a 2 branches parallèles (en plus de <code>master</code>)</div>
</div>
<div class="paragraph">
<p>On intègre cette solution à la branche principale :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout master
$ git merge hotfix</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf5.svg" alt="gf5" width="40%">
</div>
<div class="title">Figure 8. Merge de deux branches (en <em>fast-forward</em>)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> utilise ici le <strong>fast-forward</strong></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On continue à travailler sur la branche <code>iss53</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git branch -d hotfix <i class="conum" data-value="1"></i><b>(1)</b>
$ git checkout iss53
$ edit ...
$ git commit -m " blabla iss53"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Destruction de la branche devenue redondante avec <code>master</code>.</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf6.svg" alt="gf6" width="50%">
</div>
<div class="title">Figure 9. On retravaille sur <code>iss53</code></div>
</div>
<div class="paragraph">
<p>On intègre cette branche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout master
$ git merge iss53</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf7.svg" alt="gf7" width="50%">
</div>
<div class="title">Figure 10. Explications du fonctionnement du merge sans <em>fast-forward</em></div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Explications : <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> recherche la racine commune (ici <code>c3</code> pour intégrer
les branches (les commits feuilles) une par une et vérifier les conflits par itérations à partir de cette racine.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gf8.svg" alt="gf8" width="50%">
</div>
<div class="title">Figure 11. Situation finale</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>On part du principe qu&#8217;il n&#8217;y a pas eu de <a href="#conflits">Gestion des conflits</a></p>
</li>
<li>
<p>On peut maintenant supprimer <code>iss53</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bonne_utilisation">7. Bonne utilisation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_avoir_une_procédure_concertée">7.1. Avoir une procédure concertée</h3>
<div class="paragraph">
<p>Revenons sur l&#8217;exemple type :</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="http://nvie.com/posts/a-successful-git-branching-model/"><img src="images/git-branching.png" alt="git branching" width="70%"></a>
</div>
<div class="title">Figure 12. Usage classique de git (<a href="http://nvie.com/posts/a-successful-git-branching-model/" class="bare">http://nvie.com/posts/a-successful-git-branching-model/</a>)</div>
</div>
</div>
<div class="sect2">
<h3 id="_ne_pas_versionner_n_importe_quoi">7.2. Ne pas versionner n&#8217;importe quoi!</h3>
<div class="paragraph">
<p>Ce qu&#8217;il ne faut pas versionner :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les exécutables</p>
</li>
<li>
<p>les zip dont le contenu change sans arrêt</p>
</li>
<li>
<p>les images générées</p>
</li>
<li>
<p>tous les binaires en général!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_les_releases">7.3. Les "releases"</h3>
<div class="paragraph">
<p>En <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> on peut <em>taguer</em> des branches et c&#8217;est ce mécanisme qui
permet de gérer simplement les <em>releases</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git tag -a v1.0 -m "Release 1.0 as required by client"
$ git tag
v1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>On peut voir les détails d&#8217;un commit tagué :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git show v1.0
tag v1.0
Tagger: Jean-Michel Bruel &lt;jbruel@gmail.com&gt;
Date:   Fri Sep 16 14:27:20 2016 +0200

Release 1.0 as required by client

commit 47da474098d95f8ef5c3ca838be8b87d7a7ed729
Author: Jean-Michel Bruel &lt;jbruel@gmail.com&gt;
Date:   Fri Sep 16 12:38:20 2016 +0200</code></pre>
</div>
</div>
<div class="paragraph">
<p>On peut aussi taguer a posteriori :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git tag -a v1.2 9fceb02 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ajoute le tag <code>v1.2</code> au commit dont le <a href="#SHA-1">[SHA-1]</a> commence par <code>9fceb02</code></td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Par défaut les tags ne sont pas poussés sur le dépôt distant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git push origin v1.5</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_la_gestion_de_version_n_est_pas_un_long_fleuve_tranquille">8. La gestion de version n&#8217;est pas un long fleuve tranquille</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_oups_j_ai_oublié_un_truc">8.1. Oups! j&#8217;ai oublié un truc</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git commit -m 'initial commit'
$ git add forgotten_file
$ git commit --amend</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oups_j_ai_mis_trop_de_truc">8.2. Oups! j&#8217;ai mis trop de truc</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git add *.*
$ git reset *.class</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Aucun danger
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ctrl_z">8.3. CTRL+Z</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ working on some file README.adoc ...
$ git checkout -- REAME.adoc</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Danger!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_où_j_en_suis">8.4. Où j&#8217;en suis</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git status</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gitbash1.png" alt="gitbash1" width="95%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gitbash2.png" alt="gitbash2" width="95%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gitbash3.png" alt="gitbash3" width="95%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gitbash4.png" alt="gitbash4" width="95%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gestion_des_branches">9. Gestion des branches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La principale difficulté de <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> vient de la liberté en termes de branches.</p>
</div>
<div class="paragraph">
<p>Pour faire simple, je vous conseille une gestion qui marche bien pour les petites équipes,
tiré de l&#8217;excellent livre <a href="https://git-scm.com/book/en/v2/Git-Branching-Branching-Workflows">Pro Git</a> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deux branches seulement: <code>master</code> et <code>develop</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git branch
* develop     <i class="conum" data-value="1"></i><b>(1)</b>
  master      <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>develop</code> est la branche de travail qui contient la dernière version des codages en cours.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>master</code> est toujours stable et sert au déploiement</td>
</tr>
</table>
</div>
</li>
<li>
<p>On fork <code>develop</code> pour traiter un <em>bug</em> ou une <em>feature</em>.</p>
<div class="ulist">
<ul>
<li>
<p>On merge dans <code>develop</code></p>
</li>
<li>
<p>On détruit la branche devenue inutile</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce qui donne le flot suivant dès que vous devez faire une amélioration (corriger un bug ou ajouter une fonctionnalités) :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Créer une branche (e.g., <code>fix-451</code>)</p>
</li>
<li>
<p>Travailler sur cette branche</p>
</li>
<li>
<p>Merger cette branche dans <code>develop</code></p>
</li>
<li>
<p>Rejouer les tests</p>
</li>
<li>
<p>Régler les conflits éventuels</p>
</li>
<li>
<p>Quand tout fonctionne &#8658; <a href="#pull-request">Etape 7 : pull request (demande)</a></p>
</li>
<li>
<p>On peut livrer à partir de <code>master</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_les_différents_strong_merge_strong">10. Les différents <strong>merge</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les exemples suivants sont tirés de :</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate" class="bare">https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_explicit_code_merge_code">10.1. Explicit <code>merge</code></h3>
<div class="imageblock">
<div class="content">
<a class="image" href="https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate"><img src="images/what-is-a-merge.gif" alt="what is a merge" width="95%"></a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implicit_code_merge_code_via_code_rebase_code_or_code_fast_forward_code">10.2. Implicit <code>merge</code> via <code>rebase</code> or <code>fast-forward</code></h3>
<div class="imageblock">
<div class="content">
<a class="image" href="https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate"><img src="images/what-is-a-rebase.gif" alt="what is a rebase" width="95%"></a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_implicit_code_merge_code_via_code_fast_forward_code">10.3. Implicit <code>merge</code> via <code>fast-forward</code></h3>
<div class="imageblock">
<div class="content">
<a class="image" href="https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate"><img src="images/what-is-a-fast-forward.gif" alt="what is a fast forward" width="95%"></a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_squash_on_code_merge_code">10.4. Squash on <code>merge</code></h3>
<div class="imageblock">
<div class="content">
<a class="image" href="https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate"><img src="images/squash-on-merge.gif" alt="squash on merge" width="95%"></a>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conflits">11. Gestion des conflits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La principale activité du programmeur qui utilise <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> en équipe vient de la gestion des <strong>conflits</strong>.</p>
</div>
<div class="sect2">
<h3 id="_À_la_main">11.1. À la main</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>$ git checkout master
$ git merge other_branch
Auto-merging toto.txt
CONFLICT (content): Merge conflict in toto.txt
Automatic merge failed; fix conflicts and then commit the result.
$ more toto.txt
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD <i class="conum" data-value="1"></i><b>(1)</b>
Salut monde
======= <i class="conum" data-value="2"></i><b>(2)</b>
hello world!

&gt;&gt;&gt;&gt;&gt;&gt;&gt; other_branch <i class="conum" data-value="3"></i><b>(3)</b>
$ vi toto.txt <i class="conum" data-value="4"></i><b>(4)</b>
$ git commit <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Voilà où commence la différence entre la branche courante (<code>HEAD</code>)
et la branche qu&#8217;on essaye de merger (<code>other_branch</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Séparation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Voilà où se termine cette différence</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>on édite le fichier à la main pour choisir la bonne version</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>on commit pour valider la modif</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il est déconseillé d&#8217;en profiter pour faire une nouvelle modif
dans le fichier&#8230;&#8203;
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_avec_un_peu_d_aide">11.2. Avec un peu d&#8217;aide</h3>
<div class="ulist">
<ul>
<li>
<p><code>git diff</code></p>
</li>
<li>
<p><code>git difftool</code></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://sourcegear.com/diffmerge/">DiffMerge</a></p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git_avancé_git_flow">12. Git avancé : Git-Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://danielkummer.github.io/git-flow-cheatsheet/" class="bare">http://danielkummer.github.io/git-flow-cheatsheet/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_résumé_des_commandes">13. Résumé des commandes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici un schéma pour résumer la philosophie (tiré de <a href="http://osteele.com" class="bare">http://osteele.com</a>) :</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="http://osteele.com"><img src="images/git-resume.png" alt="git resume" width="50%"></a>
</div>
<div class="title">Figure 13. Résumé des commandes git (<a href="http://osteele.com" class="bare">http://osteele.com</a>)</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_liens_utiles">14. Liens utiles</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">Le site de référence</dt>
<dd>
<p><a href="http://git-scm.com/" class="bare">http://git-scm.com/</a></p>
</dd>
<dt class="hdlist1">Les "hébergeurs"</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><span class="icon"><i class="fa fa-github"></i></span> GitHub</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/">le site officiel</a></p>
</li>
<li>
<p><a href="https://stories.devacademy.la/how-to-use-github-like-a-proper-human-being-1a9c895c4e13#.ewxiz5w8l">l&#8217;étiquette</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>gitlab</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://gitlab.com/">le site officiel</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Un excellent livre en ligne sur <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a></dt>
<dd>
<p><a href="http://git-scm.com/book" class="bare">http://git-scm.com/book</a></p>
</dd>
<dt class="hdlist1">Comparaison entre merge/rebase/etc.</dt>
<dd>
<p><a href="https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate" class="bare">https://developer.atlassian.com/blog/2014/12/pull-request-merge-strategies-the-great-debate/?utm_source=twitter&amp;utm_medium=social&amp;utm_campaign=atlassian_pull-request-merge-strategies-the-great-debate</a></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossaire">15. Glossaire</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1"><em>fast_forward</em></dt>
<dd>
<p>Quand on merge une branche depuis un noeud situé  sur le même "historique".
Il s&#8217;agit donc pour <a href="http://git-scm.com/"><span class="icon"><i class="fa fa-git"></i></span></a> d&#8217;un simple déplacement de pointeur!</p>
</dd>
</dl>
</div>
<div id="SHA-1" class="dlist">
<dl>
<dt class="hdlist1">SHA-1</dt>
<dd>
<p><a href="https://fr.wikipedia.org/wiki/SHA-1" class="bare">https://fr.wikipedia.org/wiki/SHA-1</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.0 2016-09-28<br>
Last updated 2016-09-28 18:14:51 CEST
</div>
</div>
</body>
</html>